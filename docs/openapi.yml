openapi: 3.0.4
info:
  title: Concert Reservation API
  version: 1.0.0
servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://v1.api.concert.com
    description: Production server

components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
      required:
        - code
        - message

    ConcertDate:
      type: object
      properties:
        date:
          type: string
          format: date
        remainingSeats:
          type: integer
      required:
        - date
        - remainingSeats

    ConcertSeat:
      type: object
      properties:
        section:
          type: string
        row:
          type: string
        number:
          type: integer
        status:
          type: string
          enum: [AVAILABLE, TEMP_HOLD, SOLD]
      required:
        - section
        - row
        - number
        - status

    ReservationRequest:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        concertId:
          type: string
          format: uuid
        date:
          type: string
          format: date
        seats:
          type: array
          items:
            type: string
      required:
        - userId
        - concertId
        - date
        - seats

    ReservationResponse:
      type: object
      properties:
        reservationId:
          type: string
          format: uuid
        status:
          type: string
          enum: [PENDING, CONFIRMED, CANCELLED]
        reservedSeats:
          type: array
          items:
            type: string
      required:
        - reservationId
        - status
        - reservedSeats

    PaymentRequest:
      type: object
      properties:
        reservationId:
          type: string
          format: uuid
        amount:
          type: integer
      required:
        - reservationId
        - amount

    PaymentResponse:
      type: object
      properties:
        paymentId:
          type: string
          format: uuid
        status:
          type: string
          enum: [SUCCESS, FAILED]
      required:
        - paymentId
        - status

    PointRequest:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        amount:
          type: integer
      required:
        - userId
        - amount

    PointResponse:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        newBalance:
          type: integer
      required:
        - userId
        - newBalance

paths:
  /concerts:
    get:
      summary: List all concerts
      responses:
        '200':
          description: Concert list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    title:
                      type: string
                    venue:
                      type: string
                  required:
                    - id
                    - title
                    - venue
              example:
                - id: "550e8400-e29b-41d4-a716-446655440000"
                  title: "The Live Concert"
                  venue: "Seoul Arena"

  /concerts/{id}/dates:
    get:
      summary: Get available dates for a concert
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Available dates
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConcertDate'
              example:
                - date: "2025-12-31"
                  remainingSeats: 150
        '404':
          description: Concert not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /concerts/{id}/dates/{date}/seats:
    get:
      summary: Get seats for a concert on a specific date
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: date
          in: path
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: List of seats with status
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConcertSeat'
              example:
                - section: "VIP"
                  row: "A"
                  number: 1
                  status: AVAILABLE
                - section: "VIP"
                  row: "A"
                  number: 2
                  status: TEMP_HOLD
                - section: "R"
                  row: "B"
                  number: 10
                  status: SOLD
        '404':
          description: Concert or date not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reservations:
    post:
      summary: Create a reservation (TEMP_HOLD applied)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationRequest'
            example:
              userId: "123e4567-e89b-12d3-a456-426614174000"
              concertId: "550e8400-e29b-41d4-a716-446655440000"
              date: "2025-12-31"
              seats: ["A1", "A2"]
      responses:
        '201':
          description: Reservation created (TEMP_HOLD)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationResponse'
              example:
                reservationId: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
                status: PENDING
                reservedSeats: ["A1", "A2"]
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - seat already held or reserved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /payments:
    post:
      summary: Pay for a reservation (confirms TEMP_HOLD)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
            example:
              reservationId: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
              amount: 300000
      responses:
        '201':
          description: Payment successful, reservation confirmed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'
              example:
                paymentId: "9c858901-8a57-4791-81fe-4c455b099bc9"
                status: SUCCESS
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - reservation expired or already paid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reservations/{id}/status:
    get:
      summary: Get reservation status
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Current reservation status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationResponse'
              example:
                reservationId: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
                status: CONFIRMED
                reservedSeats: ["A1", "A2"]
        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /points/{userId}:
    get:
      summary: Get user's current points
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User's current points
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                    format: uuid
                  points:
                    type: integer
                required:
                  - userId
                  - points
              example:
                userId: "123e4567-e89b-12d3-a456-426614174000"
                points: 5000
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /points/charge:
    post:
      summary: Charge points to a user's account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PointRequest'
            example:
              userId: "123e4567-e89b-12d3-a456-426614174000"
              amount: 1000
      responses:
        '201':
          description: Points successfully charged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PointResponse'
              example:
                userId: "123e4567-e89b-12d3-a456-426614174000"
                newBalance: 6000
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
