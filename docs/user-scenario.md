# 1. 사용자 시나리오 작성

## 주요 시나리오
1. 로그인을하면 사용자는 대기상태인 대기열 토큰을 발급받는다.
    1. 아이디와 비밀번호를 입력한다.
    2. 로그인이 완료되면 콘서트 예약에 사용될 대기열 토큰을 발급한다.
    3. 발급된 대기열 토큰의 상태를 대기로 설정한다.
2. 사용자의 지갑 정보로 들어가 포인트 조회와 충전을 한다.
    1. 지갑 정보를 클릭한다.
    2. 현재 사용자의 포인트를 보여준다.
    3. 충전을 클릭하면 입력창을 보여준다.
    4. 입력된 금액만큼 포인트를 충전한다.
3. 콘서트를 클릭해서 원하는 날짜와 좌석을 선택하고 결제한다(성공).
    1. 콘서트를 클릭한다.
    2. 예약 가능한 날짜 목록이 조회된다.
    3. 날짜를 클릭하면 예약 가능한 좌석이 조회된다.
    4. 좌석을 선택해서 결제를 클릭하면 5분간 해당 유저에게 임시 배정된다.
    5. 토큰의 상태를 활동으로 설정한다.
    6. 결제를 완료하고 결제 내역을 저장한다.
    7. 대기열 토큰을 만료시킨다.
4. 콘서트를 클릭해서 원하는 날짜와 좌석을 선택하고 결제한다(실패).
    1. 콘서트를 클릭한다.
    2. 예약 가능한 날짜 목록이 조회된다.
    3. 날짜를 클릭하면 예약 가능한 좌석이 조회된다.
    4. 좌석을 선택해서 결제를 클릭하면 5분간 해당 유저에게 임시 배정된다.
    5. 토큰의 상태를 활동으로 설정한다.
    6. 5분의 시간이 지나 좌석에 대한 임시 배정은 해제되며 다른 사용자가 예약 할 수 있다.

# 2. 단계별 필요한 정보 정리

## 단계별 표
| 단계 | 백엔드가 받아야 할 입력 | 프론트에 보여줄 출력 | 도메인 규칙/제약 |
| ---- | ----------------------- | ------------------- | ---------------- |
| 로그인 | `id`, `password` | `wallet`, `queueToken` | 🔹 로그인 성공 시 대기열 토큰 발급<br>🔹 토큰 상태는 `"대기"`로 설정<br>🔹 동일 계정 중복 로그인 시 이전 토큰 만료 |
| 포인트 조회 | `userId` | `balance` | 🔹 최대 포인트 제한 (예: 1,000,000P)<br>🔹 포인트 단위/소수점 정책 명확히 정의<br>🔹 캐싱 정책 고려(자주 조회되는 데이터) |
| 포인트 충전 | `userId`, `amount` | `balance` (갱신됨) | 🔹최소 충전 단위 (예: 1,000P)<br>🔹 충전 실패 시 예외 코드 반환<br>🔹 외부 결제 모듈 연동 시 트랜잭션 보장 필요 |
| 날짜 조회 | `schedule` | `List<schedule>` | 🔹 공연 날짜 및 시간별 좌석 수 표시<br>🔹 날짜 기준 정렬 및 매진 여부 표시<br>🔹 캐시 만료 정책 설정 |
| 좌석 조회 | `seatId` | `List<seat>` | 🔹 좌석번호 1~50 관리<br>🔹좌석 상태(`available`, `tempHold`, `reserved`) 관리<br>🔹 좌석 동시성 제어 필요 (분산 락/Redis TTL)<br>🔹 임시 배정 타이머 표시 |
| 좌석 예약 | `scheduel`, `seatId`, `queueToken` | `payment` 화면 | 🔹 예약 시작시 좌석 상태를 `"tempHold"`로 변경<br>🔹 좌석 임시 배정 시점부터 결제 타이머 표시<br>🔹 5분 만료시 좌석 상태 자동 `"available"` 복귀 |
| 포인트 결제 | `userId`, `amount`, `queueToken` | 결제 성공 메시지 / 실패 알림 | 🔹 결제 성공 시 포인트 차감<br>🔹 결제 내역 저장<br>🔹 대기열 토큰 `"만료"` 처리<br>🔹 결제 실패 시 포인트 롤백<br>🔹 좌석 상태 `"reserved"`로 변경<br> 🔹 결제 트랜잭션 원자성 보장 |
